/* Keyball39 – tame the scroll wheel
 *
 * This overlay configures layer-specific trackball behavior:
 * - Default: Standard mouse pointer movement (potentially scaled).
 * - SCROLL layer (SCROLL): Trackball movement becomes scroll, significantly slowed down.
 */

#include <input/processors.dtsi>   /* processors come from core ZMK */

// Define layer numbers to match keyball39.keymap
#define DEFAULT 0
#define MOUSE   6
#define SCROLL  7

/ {
    /* Optional: tone the sensor down a bit globally */
    &pmw3610 {                     /* label matches tangbonze repo */
        cpi = <300>;              /* default ≈ 600 – 300 feels sane for pointer */
    };

    /* Map buttons to behaviors that exit back to DEFAULT after click */
    &zip_button_behaviors {
        bindings = <&click_and_exit_base &rclk_and_exit_base &mclk_and_exit_base>;
    };

    /* Override the processor chain for the listener */
    &trackball_listener {
        /* Auto-enable the MOUSE layer on movement; exit after 500ms idle */
        input-processors = <
            &zip_temp_layer MOUSE 500
            &zip_button_behaviors
            &zip_xy_scaler 1 1
        >;

        /* While on SCROLL layer, convert XY to scroll and slow it down */
        layer_scroll {
            layers = <SCROLL>;
            input-processors = <
                &zip_xy_to_scroll_mapper
                &zip_scroll_scaler 1 10
            >;
        };
    };
}; 